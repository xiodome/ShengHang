# 一、需求分析

## 1.需求描述

音乐，作为人类共通的语言，自文明伊始便承载着我们的情感、记忆与文化。在数字时代，音乐资源的获取前所未有地便捷，但我们也面临着新的挑战：资源分散、元数据（如歌手、专辑、风格）混乱，以及音乐爱好者之间缺乏高质量的交流社区。 

我们旨在打造一个整合、智能、有温度的音乐家园：整合相关的音乐资源，方便用户查询歌手、歌曲的相关信息，同时为用户提供一个友好交流的平台。取名声航，寓意“声音的航行”，愿我们的平台可以提供一片广阔自由的空间，为声音、为用户助航。 

我们的平台功能包括但不限于：用户可以查找音乐资源、播放音乐，后台为用户提供播放列表、查看自己的播放记录（统计播放次数等）、修改个人信息（类似网易云音乐的用户功能，可以根据个人信息关注其他人）、成为歌手的粉丝、关注他人的歌单，收藏和点赞歌单、专辑、对歌曲进行评论以及回复，并且可以对评论进行点赞。对歌单或收藏的歌曲内进行排序或筛选获取自己心仪的歌单、查看平台歌曲热度排行榜。



## 2.系统功能设计

### 2.1 功能总体结构

本系统为音乐播放与管理平台的数据库应用系统，整体采用**模块化功能结构设计**，各功能模块既相互独立又存在数据联系。其核心模块及说明如下包括：

- **用户管理模块:**

  负责用户的创建、资料修改、账号安全设置，以及关注关系管理与查看;

- **歌手与音乐管理模块:**

  负责歌手、专辑、歌曲等基础音乐资源的管理、展示与查看

- **收藏与歌单模块:**

  用户可创建、编辑、删除歌单，收藏歌曲/专辑/歌单等资源，并进行相关查看

- **评论与互动模块:**

  实现用户对歌曲、专辑、歌单的评论、点赞、拉黑、回复与查看功能

- **播放记录模块:**

  记录用户的歌曲播放历史与统计信息

- **管理员管理模块:**

  管理员可维护系统数据，以及对其余模块信息进行管理

### 2.2 各模块的具体功能

#### 2.2.1 用户管理模块

- 用户注册、登录、注销
- 修改密码、修改个人信息（含显示属性）
- 关注/取关其他用户
- 关注/取关歌手
- 查看他人信息、收藏
- 查看关注列表和粉丝列表

#### 2.2.2 歌手与音乐管理模块

- 查看歌手列表（可以按照标签进行查看，如国际、性别、出道时间等）
- 查看歌手详情页（包含歌曲总数和专辑总数）
- 查看歌手的所有专辑
- 查看专辑详情页（包含专辑总时长）
- 查看歌曲详情页
- 按关键字搜索歌手、专辑、歌曲
- 按顺序查看歌曲/专辑（按播放次数或收藏量排序）

#### 2.2.3 收藏与歌单模块

- 创建、删除、编辑歌单（涉及歌单公开性）
- 向歌单添加/移除歌曲
- 查看歌单列表（支持筛选）
- 查看歌单详情（包括歌单总时长）
- 排序与筛选歌单内容（按时间、播放次数、添加时间等排序）
- 收藏/取消收藏歌曲、专辑、歌单
- 查看与管理收藏列表（支持筛选查看）（设置收藏可见性）
- 收藏的歌曲作为一个默认的歌单（统计总时长）
- 展示平台中收藏次数最多的歌曲/专辑/歌单

#### 2.2.4 评论与互动模块

- 发布、删除评论
- 查看自己发布的评论
- 对评论进行点赞与回复
- 查看评论及其回复（对于具体的一条评论）
- 对评论进行举报
- 查看歌曲/专辑/歌单的评论列表（支持按热度和按时间查看）
- 展示评论统计信息（显示总评论数、热门评论）
- 管理自己创建的歌单下的评论

#### 2.2.5 播放记录模块

- 记录用户对歌曲的播放（设置规则避免重复记录）
- 更新和统计用户对歌曲的播放次数
- 统计歌曲、专辑、歌手的总播放次数
- 统计用户时间段内播放情况（日、周、月等）
- 用户查看播放记录（支持整体和筛选查看）
- 用户查看歌曲的具体播放记录
- 生成用户播放记录（周、月等）
- 展示用户最常听歌手/专辑/歌曲排行榜

#### 2.2.6 管理员管理模块

- 登录管理员账号
- 系统数据维护
  - 全局数据完整性维护
  - 数据一致性校验
  - 系统日志管理
- 用户信息管理
  - 查看用户列表与详细信息
  - 封禁违规用户
  - 查看用户行为统计（评论数量、播放次数等）
- 歌手与音乐资源管理
  - 上传并审核歌手、歌曲、专辑信息
  - 增删改歌手、专辑、歌曲
- 评论与歌单监管
  - 对评论、歌单发布前进行审核
  - 删除违规评论、歌单
  - 屏蔽或锁定特定评论区
  - 查看评论举报记录并处理
- 平台统计与榜单功能
  - 生成热门歌单排行榜
  - 生成热门歌曲/专辑/歌手榜
  - 生成“用户自动推荐歌单”



## 3.数据流图

### 3.1 顶层数据流图

![顶层数据流图](assets\顶层数据流图.jpg)

### 3.2 0层数据流图

![0层数据流图](assets\0层数据流图.jpg)

### 3.3 1层数据流图

#### 3.3.1 用户管理模块

![用户管理模块](assets\用户管理模块.jpg)

#### 3.3.2 歌手与音乐管理模块

![歌手与音乐管理模块](assets\歌手与音乐管理模块.jpg)

#### 3.3.3 收藏与歌单模块

![收藏与歌单模块](assets\收藏与歌单模块.jpg)

#### 3.3.4 评论与互动模块

![评论与互动模块](assets\评论与互动模块.jpg)

#### 3.3.5 播放记录模块

![播放记录模块](assets\播放记录模块.jpg)

#### 3.3.6 管理员管理模块

![管理员管理模块](assets\管理员管理模块.jpg)



## 4.数据元素表 

### 4.1 用户表（User）

| 字段名        | 数据类型                                 | 约束                      | 说明                           |
| ------------- | ---------------------------------------- | ------------------------- | ------------------------------ |
| user_id       | INT                                      | PRIMARY KEY               | 用户唯一编号                   |
| username      | VARCHAR(60)                              | UNIQUE NOT NULL           | 用户名，唯一标识用户登录与展示 |
| password      | CHAR(64)                                 | NOT NULL                  | 加密存储密码                   |
| gender        | ENUM('男','女','其他')                   | DEFAULT '其他'            | 性别                           |
| birthday      | DATE                                     | NULL                      | 出生日期                       |
| region        | VARCHAR(50)                              | NULL                      | 所在地区                       |
| email         | VARCHAR(50)                              | UNIQUE                    | 用户邮箱                       |
| register_time | DATETIME                                 | DEFAULT CURRENT_TIMESTAMP | 注册时间                       |
| profile       | VARCHAR(768)                             | NULL                      | 用户个人简介                   |
| status        | ENUM('正常','封禁中')                    | NOT NULL                  | 账号状态                       |
| visibility    | ENUM('私密','仅关注者可见','所有人可见') | DEFAULT '所有人可见'      | 信息可见性                     |

### 4.2 歌手表（Singer）

| 字段名       | 数据类型               | 约束        | 说明         |
| ------------ | ---------------------- | ----------- | ------------ |
| singer_id    | INT                    | PRIMARY KEY | 歌手唯一编号 |
| name         | VARCHAR(60)            | NOT NULL    | 歌手名称     |
| type         | ENUM('男','女','组合') | NOT NULL    | 歌手类型     |
| country      | VARCHAR(60)            | NULL        | 国籍         |
| birthday     | DATE                   | NULL        | 出生日期     |
| introduction | VARCHAR(3072)          | NULL        | 歌手简介     |

### 4.3 专辑表（Album）

| 字段名       | 数据类型      | 约束                                                         | 说明         |
| ------------ | ------------- | ------------------------------------------------------------ | ------------ |
| album_id     | INT           | PRIMARY KEY                                                  | 专辑编号     |
| title        | VARCHAR(192)  | NOT NULL                                                     | 专辑名称     |
| singer_id    | INT           | FOREIGN KEY REFERENCES **Singer**(singer_id) ON DELETE CASCADE | 所属歌手     |
| release_date | DATE          | DEFAULT 1970-01-01                                           | 发行日期     |
| cover_url    | VARCHAR(255)  | DEFAULT '/images/default_album_cover.jpg'                    | 专辑封面路径 |
| description  | VARCHAR(3072) | NULL                                                         | 专辑简介     |

### 4.4 歌曲表（Song）

| 字段名     | 数据类型     | 约束                                                         | 说明           |
| ---------- | ------------ | ------------------------------------------------------------ | -------------- |
| song_id    | INT          | PRIMARY KEY                                                  | 歌曲编号       |
| title      | VARCHAR(192) | NOT NULL                                                     | 歌曲名称       |
| album_id   | INT          | FOREIGN KEY REFERENCES **Album**(album_id) ON DELETE CASCADE | 所属专辑       |
| duration   | INT          | NOT NULL                                                     | 歌曲时长（秒） |
| file_url   | VARCHAR(255) | NOT NULL                                                     | 音频文件路径   |
| play_count | INT          | DEFAULT 0                                                    | 歌曲总播放次数 |

每首歌曲必须属于一个专辑；与歌手之间为多对多关系

### 4.5 歌单表（Songlist）

| 字段名      | 数据类型      | 约束                                                       | 说明         |
| ----------- | ------------- | ---------------------------------------------------------- | ------------ |
| songlist_id | INT           | PRIMARY KEY                                                | 歌单编号     |
| user_id     | INT           | FOREIGN KEY REFERENCES **User**(user_id) ON DELETE CASCADE | 创建者用户   |
| title       | VARCHAR(192)  | NOT NULL                                                   | 歌单名称     |
| description | VARCHAR(3072) | NULL                                                       | 歌单简介     |
| create_time | DATETIME      | DEFAULT CURRENT_TIMESTAMP                                  | 创建时间     |
| cover_url   | VARCHAR(255)  | DEFAULT '/images/default_songlist_cover.jpg'               | 封面路径     |
| like_count  | INT           | DEFAULT 0                                                  | 点赞数       |
| is_public   | BOOLEAN       | DEFAULT TRUE                                               | 歌单是否公开 |

### 4.6 评论表（Comment）

| 字段名       | 数据类型                        | 约束                                                       | 说明                     |
| ------------ | ------------------------------- | ---------------------------------------------------------- | ------------------------ |
| comment_id   | INT                             | PRIMARY KEY                                                | 评论编号                 |
| user_id      | INT                             | FOREIGN KEY REFERENCES **User**(user_id) ON DELETE CASCADE | 评论用户                 |
| target_type  | ENUM('song','album','songlist') | NOT NULL                                                   | 评论目标类型             |
| target_id    | INT                             | NOT NULL                                                   | 评论目标ID               |
| content      | VARCHAR(300)                    | NOT NULL                                                   | 评论内容                 |
| like_count   | INT                             | DEFAULT 0                                                  | 评论点赞数               |
| comment_time | DATETIME                        | DEFAULT CURRENT_TIMESTAMP                                  | 评论时间                 |
| parent_id    | INT                             | NULL                                                       | 若为回复，则记录父评论ID |
| status       | ENUM('审核中','举报中','正常')  | NOT NULL                                                   | 评论状态                 |

通过target_type和target_id定位评论目标，通过 `parent_id` 自引用实现层级评论

### 4.7 收藏表（Favorite）

| 字段名        | 数据类型                        | 约束                                                       | 说明         |
| ------------- | ------------------------------- | ---------------------------------------------------------- | ------------ |
| favorite_id   | INT                             | PRIMARY KEY                                                | 收藏记录编号 |
| user_id       | INT                             | FOREIGN KEY REFERENCES **User**(user_id) ON DELETE CASCADE | 收藏者       |
| target_type   | ENUM('song','album','songlist') | NOT NULL                                                   | 收藏对象类型 |
| target_id     | INT                             | NOT NULL                                                   | 收藏对象ID   |
| favorite_time | DATETIME                        | DEFAULT CURRENT_TIMESTAMP                                  | 收藏时间     |

通过target_type和target_id定位收藏目标

### 4.8  播放记录表（PlayHistory）

| 字段名        | 数据类型 | 约束                                                       | 说明               |
| ------------- | -------- | ---------------------------------------------------------- | ------------------ |
| play_id       | INT      | PRIMARY KEY                                                | 播放记录编号       |
| user_id       | INT      | FOREIGN KEY REFERENCES **User**(user_id) ON DELETE CASCADE | 播放用户           |
| song_id       | INT      | FOREIGN KEY REFERENCES **Song**(song_id) ON DELETE CASCADE | 播放歌曲           |
| play_time     | DATETIME | DEFAULT CURRENT_TIMESTAMP                                  | 播放时间           |
| play_duration | INT      | DEFAULT 0                                                  | 实际播放时长（秒） |

### 4.9 用户关注关系表（UserFollow）

| 字段名      | 数据类型 | 约束                                                       | 说明       |
| ----------- | -------- | ---------------------------------------------------------- | ---------- |
| follower_id | INT      | FOREIGN KEY REFERENCES **User**(user_id) ON DELETE CASCADE | 关注者用户 |
| followed_id | INT      | FOREIGN KEY REFERENCES **User**(user_id) ON DELETE CASCADE | 被关注用户 |
| follow_time | DATETIME | DEFAULT CURRENT_TIMESTAMP                                  | 关注时间   |

复合主键 PRIMARY KEY (follower_id, followed_id)

### 4.10 歌手粉丝表（SingerFollow）

| 字段名      | 数据类型 | 约束                                                         | 说明       |
| ----------- | -------- | ------------------------------------------------------------ | ---------- |
| user_id     | INT      | FOREIGN KEY REFERENCES **User**(user_id) ON DELETE CASCADE   | 关注用户   |
| singer_id   | INT      | FOREIGN KEY REFERENCES **Singer**(singer_id) ON DELETE CASCADE | 被关注歌手 |
| follow_time | DATETIME | DEFAULT CURRENT_TIMESTAMP                                    | 关注时间   |

复合主键 PRIMARY KEY (user_id, singer_id)

### 4.11 歌单-歌曲关系表（Songlist_Song）

| 字段名      | 数据类型 | 约束                                                         | 说明     |
| ----------- | -------- | ------------------------------------------------------------ | -------- |
| songlist_id | INT      | FOREIGN KEY REFERENCES **Songlist**(songlist_id) ON DELETE CASCADE | 歌单ID   |
| song_id     | INT      | FOREIGN KEY REFERENCES **Song**(song_id) ON DELETE CASCADE   | 歌曲ID   |
| add_time    | DATETIME | DEFAULT CURRENT_TIMESTAMP                                    | 添加时间 |

复合主键 PRIMARY KEY (songlist_id, song_id)

### 4.12 歌曲-歌手关系表（Song_Singer）

| 字段名    | 数据类型 | 约束                                                         | 说明   |
| --------- | -------- | ------------------------------------------------------------ | ------ |
| song_id   | INT      | FOREIGN KEY REFERENCES **Song**(song_id) ON DELETE CASCADE   | 歌曲ID |
| singer_id | INT      | FOREIGN KEY REFERENCES **Singer**(singer_id) ON DELETE CASCADE | 歌手ID |

复合主键 PRIMARY KEY (song_id, singer_id)

### 4.13* 系统日志表（SystemLog）

暂定

| 字段名       | 类型                   | 约束                       | 说明                          |
| ------------ | ---------------------- | -------------------------- | ----------------------------- |
| log_id       | INT                    | PRIMARY KEY AUTO_INCREMENT | 日志编号                      |
| action       | VARCHAR(255)           | NOT NULL                   | 操作内容（如“删除评论ID=23”） |
| target_table | VARCHAR(64)            | NULL                       | 被操作数据表名                |
| target_id    | INT                    | NULL                       | 被操作记录ID                  |
| action_time  | DATETIME               | DEFAULT CURRENT_TIMESTAMP  | 操作时间                      |
| result       | ENUM('success','fail') | NOT NULL                   | 操作结果状态                  |

### 4.14 各数据存储包含的表

- **D1**:**User**,**UserFollow**,**SingerFollow**
- **D2**:**Singer**,**Album**,**Song**,**Song_Singer**
- **D3**:**Songlist**,**Favorite**,**Songlist_Song**
- **D4**:**Comment**
- **D5**:**PlayHistory**
- **D6**:**SystemLog**



# 二、数据库概念模式设计

## 1.系统初步E-R图 

### 1.1 实体属性图

#### 1.1.1 用户属性图

<img src="assets\用户属性图.jpg" alt="用户属性图" style="zoom:33%;" />

#### 1.1.2 歌手属性图

<img src="assets\歌手属性图.jpg" alt="歌手属性图" style="zoom:33%;" />

#### 1.1.3 专辑属性图

<img src="assets\专辑属性图.jpg" alt="专辑属性图" style="zoom:33%;" />

#### 1.1.4 歌曲属性图

<img src="assets\歌曲属性图.jpg" alt="歌曲属性图" style="zoom: 33%;" />

#### 1.1.5 歌单属性图

<img src="assets\歌单属性图.jpg" alt="歌单属性图" style="zoom:33%;" />

#### 1.1.6 评论属性图

<img src="assets\评论属性图.jpg" alt="评论属性图" style="zoom:33%;" />

#### 1.1.7 收藏属性图

<img src="assets\收藏属性图.jpg" alt="收藏属性图" style="zoom:33%;" />

#### 1.1.8 播放记录属性图

<img src="assets/播放记录属性图.jpg" alt="播放记录属性图" style="zoom: 33%;" />

### 1.2 分E-R图

![分E-R图1](assets\分E-R图1.jpg)

------

<img src="assets\分E-R图2.jpg" alt="分E-R图2" style="zoom: 50%;" />

------

<img src="assets\分E-R图3.jpg" alt="分E-R图3" style="zoom:50%;" />

------

![分E-R图4](assets\分E-R图4.jpg)

------

![分E-R图5](assets\分E-R图5.jpg)



## 2.基本E-R图

（已经略去属性，详见分E-R图）

<img src="assets\实体联系图.jpg" alt="实体联系图" style="zoom:67%;" />

# 三、数据库逻辑模式设计与优化

## 1.数据库关系模式定义 

以下是由 E-R 图得到的关系模式

### 1.1 实体

用户表(<u>user_id</u>, username, password, gender, birthday, region, email, register_time, profile, status)

歌手表(<u>singer_id</u>, name, gender, country, birthday, introduction)

专辑表(<u>album_id</u>, title, singer_id, release_date, cover_url, description)

歌曲表(<u>song_id</u>, title, album_id, duration, file_url, play_count)

歌单表(<u>songlist_id</u>, user_id, title, description, create_time, cover_url, like_count, is_public)

评论表(<u>comment_id</u>, user_id, target_type, target_id, content, like_count, comment_time, parent_id, status)

收藏表(<u>favorite_id</u>, user_id, target_type, target_id, favorite_time)

播放记录表(<u>paly_id</u>, user_id, song_id, play_time, play_duration)

### 1.2 联系

用户关注关系表(<u>follower_id,  followed_id</u>, follow_time)

歌手粉丝表(<u>user_id, singer_id</u>, add_time)

歌曲-歌手关系表(<u>song_id, singer_id</u>)

### 1.3*

系统日志表(<u>log_id</u>, action, target_table, target_id, action_time, result)



## 2.关系模式范式等级的判定与规范化 

由于以上表中任意一个分量都是不可再分的数据项，故至少为**1NF**。

### 2.1 实体

- 用户表(<u>user_id</u>, username, password, gender, birthday, region, email, register_time, profile, status)

用户表中的候选码有 user_id 和 username，由于两个候选码均为单个属性，故不存在部分函数依赖；

任意两个非主属性之间不存在函数依赖关系，即任何属性不传递依赖于码，又所有函数依赖左边都有码；

综上用户表这个关系模式符合**BCNF**。

- 歌手表(<u>singer_id</u>, name, gender, country, birthday, introduction)

歌手表中候选码只有 singer_id ，且任意两个非主属性之间不存在函数依赖关系；

综上歌手表这个关系模式符合**BCNF**。

- 专辑表(<u>album_id</u>, title, singer_id, release_date, cover_url, description)

专辑表中候选码只有 album_id ，且任意两个非主属性之间不存在函数依赖关系；

综上专辑表这个关系模式符合**BCNF**。

- 歌曲表(<u>song_id</u>, title, album_id, duration, file_url, play_count)

歌曲表中候选码只有 song_id ，且任意两个非主属性之间不存在函数依赖关系；

综上歌曲表这个关系模式符合**BCNF**。

- 歌单表(<u>songlist_id</u>, user_id, title, description, create_time, cover_url, like_count, is_public)

歌单表中候选码只有 songlist_id ，且任意两个非主属性之间不存在函数依赖关系；

综上歌单表这个关系模式符合**BCNF**。

- 评论表(<u>comment_id</u>, user_id, target_type, target_id, content, like_count, comment_time, parent_id, status)

评论表中候选码只有 comment_id ，且任意两个非主属性之间不存在函数依赖关系；

综上评论表这个关系模式符合**BCNF**。

- 收藏表(<u>favorite_id</u>, user_id, target_type, target_id, favorite_time)

收藏表中候选码只有 favorite_id ，且任意两个非主属性之间不存在函数依赖关系；

综上收藏表这个关系模式符合**BCNF**。

- 播放记录表(<u>paly_id</u>, user_id, song_id, play_time, play_duration)

播放记录表中候选码只有 play_id ，且任意两个非主属性之间不存在函数依赖关系；

综上播放记录表这个关系模式符合**BCNF**。

### 2.2 联系

- 用户关注关系表(<u>follower_id,  followed_id</u>, follow_time)

用户关注关系表中候选码只有 (follower_id,  followed_id)，follow_time 显然不完全依赖于 follower_id 和 followed_id 中的任意一个，故符合**2NF**；又只有 follow_time 一个非主属性，即任何属性不传递依赖于码。

综上用户关注关系表这个关系模式符合**BCNF**。

- 歌手粉丝表(<u>user_id, singer_id</u>, add_time)

歌手粉丝表中候选码只有 (user_id,  singer_id)，add_time 显然不完全依赖于 user_id 和 singer_id 中的任意一个，故符合**2NF**；又只有 add_time 一个非主属性，即任何属性不传递依赖于码。

综上歌手粉丝表这个关系模式符合**BCNF**。

- 歌曲-歌手关系表(<u>song_id, singer_id</u>)

歌手粉丝表为全码关系模式，显然符合**BCNF**。

### 2.3*

- 系统日志表(<u>log_id</u>, action, target_table, target_id, action_time, result)

系统日志表中候选码只有 log_id ，且任意两个非主属性之间不存在函数依赖关系；

综上系统日志表这个关系模式符合**BCNF**。



综上所有关系模式范式等级均至少规范到了**3NF**。

## 3.数据库关系模式优化 

​	在进行关系模式定义定义的设计时对于所有的 $1:n$ 联系，均在 $n$ 的一端实体的属性中加入了 $1$ 这一段实体的码，实现的联系的处理；对于所有的 $m:n$ 联系，均转化为了一个单独的关系模式，如用户与用户之间的关注联系、用户与歌手之间的粉丝联系等，均单独设计了一个关系联系。



# 四、数据库物理设计

注：说明所选择的存取方法，给出索引定义。

## 4.1 存储结构与存取方法

### 4.1.1 存储引擎选择

本系统选用 **InnoDB** 作为默认的存储引擎。**选择理由如下：**

1. **事务支持（ACID）**：本系统涉及用户积分交易、悬赏支付、评论发布等操作，需要强事务支持以保证数据的一致性和完整性。
2. **行级锁定（Row-level Locking）**：在高并发场景下（如热门歌曲评论、播放记录更新），行级锁能显著减少锁冲突，提高并发性能。
3. **外键约束（Foreign Key Support）**：系统各模块间（如歌单与用户、歌曲与专辑）存在强关联，InnoDB 支持外键约束，有助于维护数据的引用完整性。

### 4.1.2 存取方法（Access Methods）

本系统采用 **B+ 树（B+ Tree）** 索引作为主要的数据存取方法。

1. **聚簇索引（Clustered Index）**：
   - 每个表的主键（Primary Key）自动构建聚簇索引。
   - 数据行实际上存储在主键索引的叶子节点中。
   - **存取优势**：通过主键（如 user_id、song_id）访问数据时效率极高，直接定位到数据页。
2. **辅助索引（Secondary Index）**：
   - 对于非主键的查询字段（如 username、email、外键字段、搜索关键词），建立辅助索引。
   - 辅助索引的叶子节点存储的是主键值，通过辅助索引找到主键后，再进行“回表”查询获取完整数据。
   - **存取优势**：极大加快 WHERE 子句筛选、JOIN 连接以及 ORDER BY 排序的速度。

## 4.2 索引定义

根据系统的业务查询需求（搜索、筛选、排序、统计），除主键索引（PRIMARY）外，设计如下索引策略：

### 4.2.1 用户管理模块索引

| 表名           | 索引名称            | 索引类型 | 字段组合                 | 建立理由                                     |
| -------------- | ------------------- | -------- | ------------------------ | -------------------------------------------- |
| **User**       | idx_user_username   | UNIQUE   | username                 | 保证用户名唯一，加速登录时的用户名查找。     |
| **User**       | idx_user_email      | UNIQUE   | email                    | 保证邮箱唯一，加速邮箱登录或找回密码查询。   |
| **UserFollow** | idx_follow_follower | INDEX    | follower_id, follow_time | 优化“我关注的人”列表查询，并按关注时间排序。 |
| **UserFollow** | idx_follow_followed | INDEX    | followed_id              | 优化“我的粉丝”列表查询。                     |

### 4.2.2 音乐资源模块索引

| 表名       | 索引名称           | 索引类型 | 字段组合                | 建立理由                                     |
| ---------- | ------------------ | -------- | ----------------------- | -------------------------------------------- |
| **Singer** | idx_singer_name    | INDEX    | singer_name             | 加速歌手名称的模糊搜索与精确查找。           |
| **Album**  | idx_album_singer   | INDEX    | singer_id, release_date | 加速查询某歌手的专辑列表，并按发行日期排序。 |
| **Album**  | idx_album_title    | INDEX    | album_title             | 加速专辑名称搜索。                           |
| **Song**   | idx_song_title     | INDEX    | song_title              | 加速歌曲名称搜索。                           |
| **Song**   | idx_song_album     | INDEX    | album_id                | 优化查询某专辑下所有歌曲的速度。             |
| **Song**   | idx_song_playcount | INDEX    | play_count              | 优化“热门歌曲排行榜”查询，避免全表扫描排序。 |

### 4.2.3 歌单与收藏模块索引

| 表名              | 索引名称           | 索引类型 | 字段组合                            | 建立理由                                                     |
| ----------------- | ------------------ | -------- | ----------------------------------- | ------------------------------------------------------------ |
| **Songlist**      | idx_songlist_user  | INDEX    | user_id, create_time                | 加速查看“某用户创建的歌单”，并按时间倒序展示。               |
| **Songlist**      | idx_songlist_title | INDEX    | songlist_title                      | 加速歌单搜索。                                               |
| **Songlist_Song** | idx_sl_song_list   | INDEX    | songlist_id, add_time               | **核心索引**：加速加载歌单详情页中的歌曲列表，并支持按添加时间排序。 |
| **Favorite**      | idx_fav_user_type  | INDEX    | user_id, target_type, favorite_time | **核心索引**：优化“我的收藏”页面查询，支持按类型筛选并按时间排序。 |
| **Favorite**      | idx_fav_target     | INDEX    | target_type, target_id              | 快速统计某对象（如歌曲）的总收藏数。                         |

### 4.2.4 评论与互动模块索引

| 表名        | 索引名称           | 索引类型 | 字段组合                       | 建立理由                                                     |
| ----------- | ------------------ | -------- | ------------------------------ | ------------------------------------------------------------ |
| **Comment** | idx_comment_target | INDEX    | target_type, target_id, status | **核心索引**：加速加载歌曲/专辑/歌单详情页下方的评论列表，仅筛选状态正常的评论。 |
| **Comment** | idx_comment_user   | INDEX    | user_id                        | 加速“我发布的评论”查询。                                     |
| **Comment** | idx_comment_time   | INDEX    | comment_time                   | 优化评论按时间倒序排列。                                     |
| **Comment** | idx_comment_like   | INDEX    | like_count                     | 优化评论按热度（点赞数）排列。                               |

### 4.2.5 播放记录与统计索引

| 表名            | 索引名称           | 索引类型 | 字段组合                | 建立理由                                                     |
| --------------- | ------------------ | -------- | ----------------------- | ------------------------------------------------------------ |
| **PlayHistory** | idx_play_user_time | INDEX    | user_id, play_time      | **核心索引**：加速生成用户个人的播放报告、听歌排行、每日趋势统计。 |
| **PlayHistory** | idx_play_song      | INDEX    | song_id                 | 用于统计单曲的总播放热度（辅助 Song 表计数校对）。           |
| **SystemLog**   | idx_log_time       | INDEX    | action_time             | 加速管理员按时间范围查询系统日志。                           |
| **SystemLog**   | idx_log_table_id   | INDEX    | target_table, target_id | 快速追踪特定对象的变更历史。                                 |





